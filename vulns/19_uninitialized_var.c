/**
 * xxxx_uninitialized_var.c
 * 测试未初始化变量检测器 (CWE-457)
 *
 * 这个文件包含各种未初始化变量的测试场景：
 * 1. 简单的未初始化局部变量
 * 2. 条件分支中的未初始化变量
 * 3. 循环中的未初始化变量
 * 4. 指针未初始化
 * 5. 数组未初始化
 * 6. 结构体未初始化
 * 7. 部分初始化的情况
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ============================================================
// 测试用例 1: 简单的未初始化局部变量 (应该检测到)
// ============================================================
void xxxx_simple_uninitialized() {
  int x;             // 未初始化
  printf("%d\n", x); // 应该检测到：x 在使用前未初始化
}

// ============================================================
// 测试用例 2: 条件初始化 - 某些路径未初始化 (应该检测到)
// ============================================================
void xxxx_conditional_uninitialized(int flag) {
  int x;
  if (flag > 0) {
    x = 10; // 只在 flag > 0 时初始化
  }
  // 当 flag <= 0 时，x 未初始化
  printf("%d\n", x); // 应该检测到：x 可能未初始化
}

// ============================================================
// 测试用例 3: 条件初始化 - 两个分支都初始化 (不应该检测到)
// ============================================================
void xxxx_conditional_initialized(int flag) {
  int x;
  if (flag > 0) {
    x = 10;
  } else {
    x = 20; // 所有路径都初始化了
  }
  printf("%d\n", x); // 安全
}

// ============================================================
// 测试用例 4: 循环中使用未初始化变量 (应该检测到)
// ============================================================
void xxxx_loop_uninitialized() {
  int x; // 未初始化
  for (int i = 0; i < 10; i++) {
    printf("%d\n", x); // 应该检测到：x 未初始化
  }
}

// ============================================================
// 测试用例 5: 循环中初始化 (不应该检测到)
// ============================================================
void xxxx_loop_initialized() {
  int x = 0; // 已初始化
  for (int i = 0; i < 10; i++) {
    x += i;
  }
  printf("%d\n", x); // 安全
}

// ============================================================
// 测试用例 6: 指针未初始化 (应该检测到)
// ============================================================
void xxxx_uninitialized_pointer() {
  int *ptr;  // 未初始化指针
  *ptr = 10; // 应该检测到：ptr 未初始化
}

// ============================================================
// 测试用例 7: 指针作为函数参数未初始化 (应该检测到)
// ============================================================
void helper_function(int *ptr) { *ptr = 10; }

void xxxx_uninitialized_pointer_param() {
  int *ptr;             // 未初始化
  helper_function(ptr); // 应该检测到：ptr 未初始化
}

// ============================================================
// 测试用例 8: 数组元素未初始化 (应该检测到)
// ============================================================
void xxxx_uninitialized_array_element() {
  int arr[10];
  printf("%d\n", arr[5]); // 应该检测到：arr[5] 未初始化
}

// ============================================================
// 测试用例 9: 部分数组初始化 (边缘情况)
// ============================================================
void xxxx_partial_array_init() {
  int arr[10] = {1, 2, 3}; // 只初始化前3个元素
  printf("%d\n", arr[0]);  // 安全
  printf("%d\n", arr[5]);  // 可能检测到（或被视为可能未初始化）
}

// ============================================================
// 测试用例 10: 多个变量，部分未初始化 (应该检测到)
// ============================================================
void xxxx_multiple_variables() {
  int a, b, c;
  a = 10;
  // b 和 c 未初始化
  printf("%d\n", a); // 安全
  printf("%d\n", b); // 应该检测到：b 未初始化
  printf("%d\n", c); // 应该检测到：c 未初始化
}

// ============================================================
// 测试用例 11: 结构体未初始化 (应该检测到)
// ============================================================
struct Point {
  int x;
  int y;
};

void xxxx_uninitialized_struct() {
  struct Point p;      // 未初始化
  printf("%d\n", p.x); // 应该检测到：p.x 未初始化
}

// ============================================================
// 测试用例 12: 嵌套条件中的未初始化变量 (应该检测到)
// ============================================================
void xxxx_nested_conditional(int a, int b) {
  int x;
  if (a > 0) {
    if (b > 0) {
      x = 100;
    }
  }
  printf("%d\n", x); // 应该检测到：x 并非所有路径都初始化
}

// ============================================================
// 测试用例 13: switch 语句中的未初始化 (应该检测到)
// ============================================================
void xxxx_switch_uninitialized(int choice) {
  int x;
  switch (choice) {
  case 1:
    x = 10;
    break;
  case 2:
    x = 20;
    break;
    // default 分支缺失，某些值下 x 未初始化
  }
  printf("%d\n", x); // 应该检测到：x 可能未初始化
}

// ============================================================
// 测试用例 14: 带 default 的 switch (不应该检测到)
// ============================================================
void xxxx_switch_initialized(int choice) {
  int x;
  switch (choice) {
  case 1:
    x = 10;
    break;
  case 2:
    x = 20;
    break;
  default:
    x = 30; // 所有情况都处理了
  }
  printf("%d\n", x); // 安全
}

// ============================================================
// 测试用例 15: 未初始化变量用于数组索引 (应该检测到)
// ============================================================
void xxxx_uninitialized_as_index() {
  int index; // 未初始化
  int arr[10] = {0};
  printf("%d\n", arr[index]); // 应该检测到：index 未初始化
}

// ============================================================
// 测试用例 16: 先赋值后使用 (不应该检测到)
// ============================================================
void xxxx_assign_then_use() {
  int x;
  x = 42;            // 赋值
  printf("%d\n", x); // 安全
}

// ============================================================
// 测试用例 17: do-while 中的未初始化 (应该检测到)
// ============================================================
void xxxx_dowhile_uninitialized() {
  int x;
  do {
    printf("%d\n", x); // 应该检测到：x 未初始化
  } while (0);
}

// ============================================================
// 测试用例 18: 全局变量 (不应该检测到，全局变量默认为0)
// ============================================================
int global_x; // 全局变量，默认初始化为0

void xxxx_global_variable() {
  printf("%d\n", global_x); // 安全（全局变量默认为0）
}

// ============================================================
// 测试用例 19: 静态局部变量 (不应该检测到，静态变量默认为0)
// ============================================================
void xxxx_static_variable() {
  static int x;      // 静态变量，默认初始化为0
  printf("%d\n", x); // 安全
}

// ============================================================
// 测试用例 20: 未初始化变量传递给函数 (应该检测到)
// ============================================================
void process_value(int val) { printf("%d\n", val); }

void xxxx_uninitialized_param() {
  int x;            // 未初始化
  process_value(x); // 应该检测到：x 未初始化
}

// ============================================================
// 主函数
// ============================================================
int main() {
  printf("xxxxing Uninitialized Variable Detector\n");
  printf("=========================================\n\n");

  // 运行所有测试
  xxxx_simple_uninitialized();
  xxxx_conditional_uninitialized(0);
  xxxx_conditional_initialized(5);
  xxxx_loop_uninitialized();
  xxxx_loop_initialized();
  // xxxx_uninitialized_pointer();  // 可能导致崩溃，注释掉
  // xxxx_uninitialized_pointer_param();  // 可能导致崩溃
  xxxx_uninitialized_array_element();
  xxxx_partial_array_init();
  xxxx_multiple_variables();
  // xxxx_uninitialized_struct();  // 可能检测到
  xxxx_nested_conditional(1, 0);
  xxxx_switch_uninitialized(3);
  xxxx_switch_initialized(2);
  // xxxx_uninitialized_as_index();  // 可能导致崩溃
  xxxx_assign_then_use();
  // xxxx_dowhile_uninitialized();  // 可能导致崩溃
  xxxx_global_variable();
  xxxx_static_variable();
  // xxxx_uninitialized_param();  // 可能产生未定义行为

  printf("\n=========================================\n");
  printf("All xxxxs completed.\n");
  return 0;
}
